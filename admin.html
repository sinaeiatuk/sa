<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | ØµÙ†Ø§Ø¹ÙŠØªÙƒ</title>

<style>
/* ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© - Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ Ø§Ù„ÙØ®Ù… */
* { box-sizing: border-box; transition: all 0.3s ease; }
body { margin: 0; font-family: "Segoe UI", Tahoma, sans-serif; background: #0b0f19; color: #f8fafc; direction: rtl; line-height: 1.6; }
.container { max-width: 1200px; margin: auto; padding: 20px; }

/* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
h1 {
    text-align: center; margin-bottom: 30px; font-size: 2rem;
    background: linear-gradient(45deg, #fff, #38bdf8);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold;
}

/* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Tabs) */
.tabs { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; }
.tab-btn {
    background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
    color: #94a3b8; padding: 12px 25px; border-radius: 12px; cursor: pointer;
    font-size: 1.1rem; font-weight: bold; width: 150px; text-align: center;
}
.tab-btn.active {
    background: linear-gradient(135deg, #6366f1, #a855f7); color: white;
    border-color: transparent; box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
}
.tab-content { display: none; animation: fadeIn 0.5s ease; }
.tab-content.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* --- Ù‚Ø³Ù… Ø§Ù„Ø´Ø§Øª (Ø§Ù„Ø¬Ø¯ÙŠØ¯) --- */
.chat-layout {
    display: grid; grid-template-columns: 300px 1fr; gap: 20px;
    background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px; height: 600px; overflow: hidden;
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ */
.users-list {
    background: rgba(0, 0, 0, 0.2); border-left: 1px solid rgba(255, 255, 255, 0.1);
    overflow-y: auto; padding: 10px;
}
.user-item {
    padding: 15px; border-radius: 12px; cursor: pointer; margin-bottom: 8px;
    background: rgba(255, 255, 255, 0.03); display: flex; align-items: center; gap: 10px;
}
.user-item:hover { background: rgba(255, 255, 255, 0.08); }
.user-item.active { background: rgba(99, 102, 241, 0.2); border: 1px solid #6366f1; }
.user-avatar {
    width: 40px; height: 40px; border-radius: 50%; background: #334155;
    display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
}
.unread-dot {
    width: 10px; height: 10px; background: #ef4444; border-radius: 50%; margin-right: auto;
}

/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
.chat-area { display: flex; flex-direction: column; background: rgba(0, 0, 0, 0.4); position: relative; }
.empty-state {
    display: flex; align-items: center; justify-content: center; height: 100%;
    color: #94a3b8; font-size: 1.2rem; flex-direction: column; gap: 10px;
}
.chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
.msg {
    max-width: 70%; padding: 12px 16px; border-radius: 15px; font-size: 0.95rem; line-height: 1.5;
}
.msg-user { align-self: flex-start; background: rgba(255, 255, 255, 0.1); color: #e2e8f0; border-bottom-left-radius: 2px; }
.msg-admin { align-self: flex-end; background: #6366f1; color: white; border-bottom-right-radius: 2px; }

.chat-input-area {
    padding: 20px; background: rgba(15, 23, 42, 0.95);
    border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; gap: 10px;
}
.chat-input-area input {
    flex: 1; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 30px; padding: 12px 20px; color: white; outline: none;
}
.send-btn {
    width: 50px; height: 50px; border-radius: 50%; border: none;
    background: linear-gradient(135deg, #6366f1, #a855f7); color: white; cursor: pointer;
    font-size: 1.2rem; display: flex; align-items: center; justify-content: center;
}

/* --- ØªØµÙ…ÙŠÙ… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´ Ø§Ù„Ù‚Ø¯ÙŠÙ… (ÙƒÙ…Ø§ Ù‡Ùˆ) --- */
.panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); padding: 25px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 40px; }
.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
input, select, textarea { width: 100%; padding: 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #fff; outline: none; }
input:focus, select:focus, textarea:focus { border-color: #38bdf8; background: rgba(255, 255, 255, 0.08); }
textarea { min-height: 120px; }
button { background: linear-gradient(135deg, #38bdf8, #1d4ed8); color: #fff; border: none; padding: 14px 25px; border-radius: 12px; cursor: pointer; font-weight: 600; }
.cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
.card { background: rgba(255, 255, 255, 0.03); border-radius: 20px; padding: 20px; border: 1px solid rgba(255, 255, 255, 0.08); position: relative; overflow: hidden; }
.badge { background: rgba(56, 189, 248, 0.2); color: #38bdf8; padding: 6px 14px; border-radius: 30px; display: inline-block; margin-bottom: 10px; }
.actions { display: flex; gap: 12px; margin-top: 20px; }
.del { background: linear-gradient(135deg, #ef4444, #991b1b) !important; }
.edit { background: linear-gradient(135deg, #10b981, #065f46) !important; }
.back-home { display: inline-flex; align-items: center; gap: 10px; padding: 12px 22px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 14px; color: #38bdf8; text-decoration: none; font-weight: 600; margin-bottom: 25px; }
</style>
</head>

<body>
<div class="container">
    <a href="index.html" class="back-home"><span>ğŸ </span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</a>
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>

    <div class="tabs">
        <div class="tab-btn active" onclick="switchTab('workshops')">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´</div>
        <div class="tab-btn" onclick="switchTab('messages')">ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
    </div>

    <div id="workshops-tab" class="tab-content active">
        <div class="panel">
            <form id="form">
                <div class="grid">
                    <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø©" required>
                    <input id="phone" type="number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (ÙˆØ§ØªØ³Ø§Ø¨)" required>
                    <select id="cat">
                        <option value="cars">Ø³ÙŠØ§Ø±Ø§Øª</option>
                        <option value="metal">Ø­Ø¯Ø§Ø¯Ø© Ùˆ Ø§Ù„Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
                        <option value="sofa">ÙƒÙ†Ø¨</option>
                        <option value="aluminum">Ø§Ù„Ù…ÙƒÙŠÙØ§Øª Ùˆ Ø§Ù„ØºØ³Ø§Ù„Ø§Øª</option>
                    </select>
                    <input id="map" placeholder="Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆØ±Ø´Ø© (Google Maps)" required>
                </div>
                <br>
                <textarea id="spec" placeholder="ÙˆØµÙ Ø§Ù„ÙˆØ±Ø´Ø©" required></textarea>
                <input id="cover" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¹Ø±Ø¶ (Card Cover)">
                <textarea id="images" placeholder="Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± (ÙƒÙ„ Ø±Ø§Ø¨Ø· Ø¨Ø³Ø·Ø± â€“ 6 ØµÙˆØ± ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)"></textarea>
                <br><br>
                <button>ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙˆØ±Ø´Ø©</button>
            </form>
        </div>
        <div class="cards" id="list"></div>
    </div>

    <div id="messages-tab" class="tab-content">
        <div class="chat-layout">
            <div class="users-list" id="usersList">
                </div>

            <div class="chat-area">
                <div id="emptyState" class="empty-state">
                    <span>ğŸ‘ˆ Ø§Ø®ØªØ± Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ø¨Ø¯Ø¡</span>
                </div>
                <div id="chatInterface" style="display:none; height:100%; flex-direction:column;">
                    <div class="chat-messages" id="adminChatBody"></div>
                    <div class="chat-input-area">
                        <input type="text" id="adminMsgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù‡Ù†Ø§..." onkeypress="handleAdminEnter(event)">
                        <button class="send-btn" onclick="sendAdminMessage()">â¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, onSnapshot, query, orderBy, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBdhesRwD2eiDvqqcMGhC59U4whICwTO3E",
  authDomain: "sanaeya-samtah.firebaseapp.com",
  projectId: "sanaeya-samtah",
  storageBucket: "sanaeya-samtah.firebasestorage.app",
  messagingSenderId: "1092994215610",
  appId: "1:1092994215610:web:e68b5a3eccb24235d39c83"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ---
window.switchTab = (tabName) => {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
    
    document.getElementById(tabName + '-tab').classList.add('active');
    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
    if(tabName === 'workshops') document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
    else document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
};

/* ================== ÙƒÙˆØ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´ (Ø§Ù„Ù‚Ø¯ÙŠÙ…) ================== */
const form = document.getElementById("form");
const list = document.getElementById("list");
const inputs = {
    name: document.getElementById("name"),
    phone: document.getElementById("phone"),
    cat: document.getElementById("cat"),
    map: document.getElementById("map"),
    spec: document.getElementById("spec"),
    images: document.getElementById("images"),
    cover: document.getElementById("cover")
};
let editId = null;

async function loadWorkshops(){
  list.innerHTML="";
  const snap = await getDocs(collection(db,"workshops"));
  snap.forEach(d=>{
    const w=d.data();
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <span class="badge">${w.cat}</span>
      <h3>${w.name}</h3>
      <p>${w.spec}</p>
      <a href="https://wa.me/${w.phone}" target="_blank">${w.phone}</a>
      <div class="actions">
        <button class="edit" onclick="editWorkshop('${d.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="del" onclick="delWorkshop('${d.id}')">Ø­Ø°Ù</button>
      </div>
    `;
    list.appendChild(c);
  });
}

window.delWorkshop=async id=>{
  if(confirm("Ø­Ø°Ù Ø§Ù„ÙˆØ±Ø´Ø©ØŸ")){
    await deleteDoc(doc(db,"workshops",id));
    loadWorkshops();
  }
};

window.editWorkshop=async id=>{
  const snap = await getDocs(collection(db,"workshops"));
  snap.forEach(d=>{
    if(d.id===id){
      const w=d.data();
      editId=id;
      inputs.name.value=w.name;
      inputs.phone.value=w.phone;
      inputs.cat.value=w.cat;
      inputs.map.value=w.map;
      inputs.spec.value=w.spec;
      inputs.cover.value=w.cover || "";
      inputs.images.value=(w.images||[]).join("\n");
      window.scrollTo(0,0);
    }
  });
};

form.onsubmit=async e=>{
  e.preventDefault();
  const images = inputs.images.value.split("\n").map(i=>i.trim()).filter(i=>i).slice(0,6);
  const data={
    name: inputs.name.value.trim(),
    phone: inputs.phone.value.trim(),
    cat: inputs.cat.value,
    map: inputs.map.value.trim(),
    spec: inputs.spec.value.trim(),
    cover: inputs.cover.value.trim(),
    images
  };

  if(editId){
    await updateDoc(doc(db,"workshops",editId),data);
    editId=null;
  }else{
    await addDoc(collection(db,"workshops"),data);
  }
  form.reset();
  loadWorkshops();
  alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸");
};

/* ================== ÙƒÙˆØ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Øª (Ø§Ù„Ø¬Ø¯ÙŠØ¯) ================== */
let activeChatId = null;
let chatUnsubscribe = null;

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ø£Ø±Ø³Ù„ÙˆØ§ Ø±Ø³Ø§Ø¦Ù„
// (Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ Ø³Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¬Ù„Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ø© `support_chats` Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)
// Ù…Ù„Ø§Ø­Ø¸Ø©: Firestore Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„ÙˆÙŠØ¨ Ø¨Ø³Ù‡ÙˆÙ„Ø©ØŒ
// Ù„Ø°Ù„Ùƒ Ø³Ù†Ø³ØªØ®Ø¯Ù… "Ø­ÙŠÙ„Ø©" Ø¨Ø³ÙŠØ·Ø©: Ø³Ù†Ø®Ø²Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù†ÙØµÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ØŒ
// Ù„ÙƒÙ† Ø­Ø§Ù„ÙŠØ§Ù‹ ÙˆÙ„Ù„ØªØ³Ù‡ÙŠÙ„ØŒ Ø³Ù†ÙØªØ±Ø¶ Ø£Ù†Ù†Ø§ Ù†Ø¹Ø±Ù Ø§Ù„Ù€ ID (Ø£Ùˆ Ø³Ù†Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆÙ†Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª).
// *Ù„Ø­Ù„ Ø£Ø³Ø±Ø¹*: Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ¹Ø±Ø¶ "Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª" Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ 
// ÙˆÙ„ÙƒÙ† Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ØµØ­ Ù‡ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© `users` Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. 
// **Ù„Ø°Ù„ÙƒØŒ Ù„ÙƒÙŠ ÙŠØ¹Ù…Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… 100%ØŒ Ù†Ø­ØªØ§Ø¬ Ø£Ù† ÙŠØ±Ø³Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹.**

// (ØªØ­Ø¯ÙŠØ«: Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ ÙØªØ­Ù†Ø§ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ Listener Ø°ÙƒÙŠ ÙŠØ¬Ù„Ø¨ Ù„Ùƒ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯Ù‡ Ø±Ø³Ø§Ø¦Ù„)
// Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø³Ø£Ø¹Ø±Ø¶ Ù„Ùƒ "Ù…Ø­Ø§ÙƒØ§Ø©" Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø§ØªØŒ ÙˆØ¹Ù†Ø¯Ù…Ø§ ÙŠØ±Ø³Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§.

// 1. Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª (Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù„Ø¨ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Ø±Ø³Ø§Ø¦Ù„)
// Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØªØ·Ù„Ø¨ Ù‡ÙŠÙƒÙ„Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© (Ù‚Ø§Ø¦Ù…Ø© "Last Messages")ØŒ 
// Ø³Ø£Ø¨Ø³Ø·Ù‡Ø§ Ù„Ùƒ: Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ "Ù‚Ø§Ø¦Ù…Ø© ÙˆÙ‡Ù…ÙŠØ©" ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… ØªØ¹Ø±ÙÙ‡ØŒ 
// Ø£Ùˆ Ø³Ø£Ø·Ù„Ø¨ Ù…Ù†Ùƒ (Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹) Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ ØµØºÙŠØ± ÙÙŠ `index.html` ÙŠØ³Ø¬Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„.

// **Ø§Ù„Ø­Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠ Ø§Ù„Ø¢Ù†:** Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ Listen Ø¹Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.
// Ø¨Ù…Ø§ Ø£Ù† Ù‡Ø°Ø§ Ù…Ø¹Ù‚Ø¯ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙÙŠ Firestore Ø¨Ø¯ÙˆÙ† Cloud FunctionsØŒ Ø³Ø£ÙØªØ±Ø¶ Ø£Ù†Ùƒ (Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†)
// Ø³ØªÙØªØ­ Ø´Ø§Øª Ù…Ø­Ø¯Ø¯. Ù„ÙƒÙ† Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø£Ù…ÙˆØ±:
// Ø³Ø£Ø¬Ø¹Ù„Ùƒ ØªØ¯Ø®Ù„ "ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ Ø£Ùˆ Ø³Ø£Ø¹Ø±Ø¶ Ù„Ùƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒÙ†Øª ÙØ§ØªØ­ ØµÙØ­ØªÙŠÙ†.

// **ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ:** Ø³Ø£Ø³ØªØ®Ø¯Ù… Ø·Ø±ÙŠÙ‚Ø© Ø£Ø°ÙƒÙ‰. 
// Ø³Ø£Ø·Ù„Ø¨ Ù…Ù†Ùƒ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø´Ø§ØªØŒ ÙˆØ¨Ù…Ø¬Ø±Ø¯ ÙˆØµÙˆÙ„ Ø±Ø³Ø§Ù„Ø©ØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨ØªØ®Ø²ÙŠÙ†Ù‡Ø§.

async function loadChatUsers() {
    // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªØ­ØªØ§Ø¬ "Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†" (Users Collection).
    // Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù„Ù… Ù†Ù†Ø´Ø¦Ù‡Ø§ØŒ Ø³Ø£Ø¶ÙŠÙ Ù„Ùƒ Ù…ÙŠØ²Ø©: "Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù…" Ø£Ùˆ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø«Ø§Ø¨ØªØ© Ù„Ù„ØªØ¬Ø±Ø¨Ø©.
    // Ù„ÙƒÙ† Ø§Ù„Ø£ÙØ¶Ù„: Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¬ÙŠÙ‡ÙŠØ©.
    
    // **Ù…Ø¤Ù‚ØªØ§Ù‹:** Ø³Ø£Ø¹Ø±Ø¶ Ù„Ùƒ Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©ØŒ ÙˆØ¨Ù…Ø¬Ø±Ø¯ Ø£Ù† ÙŠØ±Ø³Ù„ Ø£Ø­Ø¯ØŒ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§.
    // (ÙŠØªØ·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· ÙÙŠ index.html Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© `active_chats` - Ø³Ø£Ø¶ÙŠÙÙ‡ Ù„Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹).
    
    // Ù„Ù„Ø¢Ù†: Ø³Ø£Ø¶Ø¹ Ù„Ùƒ "Ø²Ø± ØªØ­Ø¯ÙŠØ«" ÙŠØ¬Ù„Ø¨ Ù„Ùƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ‡Ù… Ø±Ø³Ø§Ø¦Ù„.
}

// 2. ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ÙŠÙ†
window.openChat = (uid) => {
    activeChatId = uid;
    document.getElementById('emptyState').style.display = 'none';
    document.getElementById('chatInterface').style.display = 'flex';
    document.querySelectorAll('.user-item').forEach(u => u.classList.remove('active'));
    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø®ØªØ§Ø± (Ø³Ù†Ø¶ÙŠÙÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    
    if (chatUnsubscribe) chatUnsubscribe();

    const q = query(
        collection(db, `support_chats/${uid}/messages`), 
        orderBy("createdAt", "asc")
    );

    chatUnsubscribe = onSnapshot(q, (snapshot) => {
        const body = document.getElementById('adminChatBody');
        body.innerHTML = '';
        snapshot.forEach(doc => {
            const msg = doc.data();
            const div = document.createElement('div');
            div.className = `msg ${msg.sender === 'admin' ? 'msg-admin' : 'msg-user'}`;
            div.innerText = msg.text;
            body.appendChild(div);
        });
        body.scrollTop = body.scrollHeight;
    });
};

// 3. Ø¥Ø±Ø³Ø§Ù„ Ø±Ø¯ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†
window.sendAdminMessage = async () => {
    const input = document.getElementById('adminMsgInput');
    const text = input.value.trim();
    if (!text || !activeChatId) return;

    input.value = '';
    await addDoc(collection(db, `support_chats/${activeChatId}/messages`), {
        text: text,
        sender: 'admin',
        createdAt: serverTimestamp()
    });
};

window.handleAdminEnter = (e) => {
    if (e.key === 'Enter') sendAdminMessage();
};

/* --- Ù…ÙŠØ²Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ø°ÙƒÙŠØ©: ÙƒØ§Ø´Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† --- */
// Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù„Ø§ Ù†Ù…Ù„Ùƒ Ù‚Ø§Ø¦Ù…Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø§Ù‡Ø²Ø©ØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† 
// Ø§Ù„Ø°ÙŠÙ† ØªØ±Ø§Ø³Ù„ÙˆØ§ Ù…Ø¹Ùƒ "Ø§Ù„Ø¢Ù†" Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ù…Ø¹Ø±ÙØªÙ‡Ù… Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ (Ù…Ø¤Ù‚ØªØ§Ù‹) Ø£Ùˆ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Auth.
// **Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø­Ø±ÙŠ:** Ø³Ø£Ø¶ÙŠÙ Ù„Ùƒ ÙƒÙˆØ¯Ø§Ù‹ ÙŠØ¬Ù„Ø¨ Ù„Ùƒ ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©.
// (ÙŠØªØ·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ³Ù…Ø­ Ø¨Ù€ listCollectionsØŒ ÙˆÙ‡Ø°Ø§ ØµØ¹Ø¨ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­).

// **Ù„Ø°Ù„ÙƒØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø­ÙŠÙ„Ø© Ø¨Ø³ÙŠØ·Ø©:**
// Ø³Ø£Ø¹Ø±Ø¶ Ù„Ùƒ "Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ" (Ø£Ù†Øª Ù†ÙØ³Ùƒ) Ù„ØªØ¬Ø±Ø¨ Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡.
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
const auth = getAuth(app);

onAuthStateChanged(auth, user => {
    if(user) {
        // Ø³Ø£Ø¶ÙŠÙÙƒ Ø£Ù†Øª Ù†ÙØ³Ùƒ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ÙƒÙŠ ØªØ¬Ø±Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù…
        const usersList = document.getElementById('usersList');
        usersList.innerHTML = `
            <div class="user-item" onclick="openChat('${user.uid}')">
                <div class="user-avatar">ğŸ‘¤</div>
                <div>
                    <div style="font-weight:bold">Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ (Ø£Ù†Øª)</div>
                    <div style="font-size:0.8rem; color:#94a3b8">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„ØªØ¬Ø±Ø¨Ø©</div>
                </div>
            </div>
        `;
    }
});

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
loadWorkshops();

</script>
</body>
</html>
